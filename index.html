<!DOCTYPE html>
<html>
<head>
  <title>Download Raw Firebase Data (CSV)</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <button onclick="downloadCSV()">Download Raw Data (CSV)</button>

  <script>
    // üîπ Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyD-yb8LkhqSKvNKL6c0P14f5fhvSZoEgXI",
      authDomain: "agora-vat-checks.firebaseapp.com",
      projectId: "agora-vat-checks",
      storageBucket: "agora-vat-checks.appspot.com",
      messagingSenderId: "1080509010890",
      appId: "1:1080509010890:web:7f8b54ce92a5cd6311d6b8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function downloadCSV() {
      try {
        const snapshot = await db.collection("farms").get(); // üîπ change if collection name is different
        if (snapshot.empty) {
          alert("‚ö†Ô∏è No documents found in collection!");
          return;
        }

        // Build CSV header from first doc
        let csv = "id," + Object.keys(snapshot.docs[0].data()).join(",") + "\n";

        snapshot.forEach(doc => {
          const row = [doc.id, ...Object.values(doc.data())];
          csv += row.map(v => `"${String(v).replace(/"/g, '""')}"`).join(",") + "\n";
        });

        // Trigger file download
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "farms_raw.csv";
        a.click();
        URL.revokeObjectURL(url);

        console.log("‚úÖ Data downloaded successfully");
      } catch (err) {
        console.error("‚ùå Error fetching data:", err);
        alert("Error fetching data, check console.");
      }
    }
  </script>
</body>
</html>