<!DOCTYPE html>
<html>
<head>
  <title>Download Raw Firebase Data (CSV)</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <button onclick="downloadCSV()">Download Raw Data (CSV)</button>

  <script>
    // ðŸ”¹ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function downloadCSV() {
      try {
        const snapshot = await db.collection("farms").get(); // âš¡ change 'farms' if different
        if (snapshot.empty) {
          alert("No documents found in collection!");
          return;
        }

        // Convert to CSV
        let csv = "id," + Object.keys(snapshot.docs[0].data()).join(",") + "\n";
        snapshot.forEach(doc => {
          const row = [doc.id, ...Object.values(doc.data())];
          csv += row.map(v => `"${String(v).replace(/"/g, '""')}"`).join(",") + "\n";
        });

        // Download
        const blob = new Blob([csv], { type: "text/csv" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "farms_raw.csv";
        a.click();
        URL.revokeObjectURL(url);

        console.log("âœ… Data downloaded");
      } catch (err) {
        console.error("Error fetching data:", err);
        alert("Error fetching data, check console.");
      }
    }
  </script>
</body>
</html>