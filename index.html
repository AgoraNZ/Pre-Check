<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Download Pre Check Raw Data</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
</head>
<body>
  <button id="downloadBtn">Download Pre Check Data</button>
  <pre id="output"></pre>

  <script>
    // ---------- Firebase ----------
    const cfg = {
      apiKey: "AIzaSyDr9nA44Kkej*****GUzbMDECI8cTFI",
      authDomain: "dairy-farm-record-system.firebaseapp.com",
      projectId: "dairy-farm-record-system",
      storageBucket: "dairy-farm-record-system.appspot.com",
      messagingSenderId: "422124188212",
      appId: "1:422124188212:web:1bd31bee8d6e91e301d061"
    };
    firebase.initializeApp(cfg);
    const storage = firebase.storage();
    const folder = "Pre Check";

    document.getElementById("downloadBtn").addEventListener("click", async () => {
      const listRef = storage.ref(folder);
      const res = await listRef.listAll();

      let output = [];
      for (const item of res.items) {
        const url = await item.getDownloadURL();
        const resp = await fetch(url);
        const text = await resp.text(); // works for CSV/JSON/plain
        output.push({ name: item.name, data: text });
      }

      // Show in browser
      document.getElementById("output").textContent = JSON.stringify(output, null, 2);

      // Force download as raw.json
      const blob = new Blob([JSON.stringify(output)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "PreCheck_Raw.json";
      a.click();
    });
  </script>
</body>
</html>